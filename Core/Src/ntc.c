/*
 * ntc.c
 *
 *  Created on: Aug 11, 2025
 *      Author: Cellah_SW
 */

#include "ntc.h"

#if 0

#endif

/* ========= 사용자 설정 ========= */
// ADC 핀 구성: VCC → RFIX → ADC_INx → NTC → GND
#define VREF_V              3.3f           // Vref=VCC로 가정 (F1 기본)
#define ADC_MAX_COUNT       4095.0f        // 12-bit
#define RFIX_OHMS           18000.0f        // 형님 구조에 맞게 (예: 2kΩ). 18kΩ 쓰면 18000.0f로





/* ========= 테이블(저항→온도) =========
   주어진 값(Ω, °C). 저항은 온도 증가에 따라 감소(NTC).
*/



/* ========= 변환: ADC → 저항 =========
   R_NTC = RFIX * ADC / (ADC_MAX - ADC)
   (Vref=Vcc 가정. ADC=0 또는 ADC=4095 극단값 예외처리)
*/
 uint8_t NTC_AdcToResistance(uint16_t adc, float *r_ntc)
{
    if (!r_ntc) return 0;

    if (adc == 0) {
        // Vadc=0 → Rntc?0Ω (범위 밖)
        return 0;
    }
    if (adc >= (uint16_t)ADC_MAX_COUNT) {
        // Vadc?Vref → Rntc→∞ (범위 밖)
        return 0;
    }

    float adc_f = (float)adc;
    *r_ntc = RFIX_OHMS * (adc_f / (ADC_MAX_COUNT - adc_f));
    return 1;
}



 uint32_t adcChNum,adcChBuff[11], adcChAvg;
uint16_t rawADCbuff[11];

/* ========= ADC 구동 ========= */
 uint16_t ADC1_ReadOnce(void)
{

    adcChNum++;
	if(adcChNum==2)
	{
		adcChNum = 4;
	}
    adcChNum %= 10;

	ADC1_Channel_Selection(adcChNum);
    HAL_ADC_Start(&hadc1);
    HAL_ADC_PollForConversion(&hadc1, HAL_MAX_DELAY);
    uint16_t v = (uint16_t)HAL_ADC_GetValue(&hadc1);
    HAL_ADC_Stop(&hadc1);
	rawADCbuff[adcChNum] = v;


    return v;
}



uint16_t tempTable[301][2] =
{
	{0		,28220 },	//0.0도
	{1		,28092 },	//0.1도
	{2		,27964 },	//0.2도
	{3		,27837 },	//0.3도
	{4		,27709 },	//0.4도
	{5		,27581 },	//0.5도
	{6		,27453 },	//0.6도
	{7		,27325 },	//0.7도
	{8		,27198 },	//0.8도
	{9		,27070 },	//0.9도
	{10		,26942 },	//1.0도
	{11		,26823 },	//1.1도
	{12		,26703 },	//1.2도
	{13		,26584 },	//1.3도
	{14		,26465 },	//1.4도
	{15		,26346 },	//1.5도
	{16		,26226 },	//1.6도
	{17		,26107 },	//1.7도
	{18		,25988 },	//1.8도
	{19		,25868 },	//1.9도
	{20		,25749 },	//2.0도
	{21		,25637 },	//2.1도
	{22		,25526 },	//2.2도
	{23		,25414 },	//2.3도
	{24		,25303 },	//2.4도
	{25		,25191 },	//2.5도
	{26		,25121 },	//2.6도
	{27		,25052 },	//2.7도
	{28		,24982 },	//2.8도
	{29		,24912 },	//2.9도
	{30		,24843 },	//3.0도
	{31		,24773 },	//3.1도
	{32		,24704 },	//3.2도
	{33		,24634 },	//3.3도
	{34		,24373 },	//3.4도
	{35		,24112 },	//3.5도
	{36		,24008 },	//3.6도
	{37		,23904 },	//3.7도
	{38		,23799 },	//3.8도
	{39		,23695 },	//3.9도
	{40		,23591 },	//4.0도
	{41		,23493 },	//4.1도
	{42		,23395 },	//4.2도
	{43		,23298 },	//4.3도
	{44		,23200 },	//4.4도
	{45		,23102 },	//4.5도
	{46		,23004 },	//4.6도
	{47		,22906 },	//4.7도
	{48		,22809 },	//4.8도
	{49		,22711 },	//4.9도
	{50		,22613 },	//5.0도
	{51		,22521 },	//5.1도
	{52		,22430 },	//5.2도
	{53		,22338 },	//5.3도
	{54		,22247 },	//5.4도
	{55		,22155 },	//5.5도
	{56		,22063 },	//5.6도
	{57		,21972 },	//5.7도
	{58		,21880 },	//5.8도
	{59		,21789 },	//5.9도
	{60		,21697 },	//6.0도
	{61		,21611 },	//6.1도
	{62		,21525 },	//6.2도
	{63		,21439 },	//6.3도
	{64		,21353 },	//6.4도
	{65		,21267 },	//6.5도
	{66		,21181 },	//6.6도
	{67		,21095 },	//6.7도
	{68		,21009 },	//6.8도
	{69		,20923 },	//6.9도
	{70		,20837 },	//7.0도
	{71		,20756 },	//7.1도
	{72		,20675 },	//7.2도
	{73		,20594 },	//7.3도
	{74		,20513 },	//7.4도
	{75		,20432 },	//7.5도
	{76		,20351 },	//7.6도
	{77		,20270 },	//7.7도
	{78		,20190 },	//7.8도
	{79		,20109 },	//7.9도
	{80		,20028 },	//8.0도
	{81		,19952 },	//8.1도
	{82		,19876 },	//8.2도
	{83		,19800 },	//8.3도
	{84		,19724 },	//8.4도
	{85		,19648 },	//8.5도
	{86		,19572 },	//8.6도
	{87		,19496 },	//8.7도
	{88		,19419 },	//8.8도
	{89		,19343 },	//8.9도
	{90		,19267 },	//9.0도
	{91		,19167 },	//9.1도
	{92		,19067 },	//9.2도
	{93		,18968 },	//9.3도
	{94		,18868 },	//9.4도
	{95		,18768 },	//9.5도
	{96		,18668 },	//9.6도
	{97		,18569 },	//9.7도
	{98		,18469 },	//9.8도
	{99		,18370 },	//9.9도
	{100		,18270 },	//10.0도
	{101		,18186 },	//10.1도
	{102		,18103 },	//10.2도
	{103		,18019 },	//10.3도
	{104		,17936 },	//10.4도
	{105		,17852 },	//10.5도
	{106		,17768 },	//10.6도
	{107		,17684 },	//10.7도
	{108		,17601 },	//10.8도
	{109		,17517 },	//10.9도
	{110		,17433 },	//11.0도
	{111		,17354 },	//11.1도
	{112		,17275 },	//11.2도
	{113		,17197 },	//11.3도
	{114		,17118 },	//11.4도
	{115		,17039 },	//11.5도
	{116		,16960 },	//11.6도
	{117		,16881 },	//11.7도
	{118		,16803 },	//11.8도
	{119		,16724 },	//11.9도
	{120		,16645 },	//12.0도
	{121		,16571 },	//12.1도
	{122		,16497 },	//12.2도
	{123		,16422 },	//12.3도
	{124		,16348 },	//12.4도
	{125		,16274 },	//12.5도
	{126		,16200 },	//12.6도
	{127		,16126 },	//12.7도
	{128		,16051 },	//12.8도
	{129		,15977 },	//12.9도
	{130		,15903 },	//13.0도
	{131		,15833 },	//13.1도
	{132		,15763 },	//13.2도
	{133		,15694 },	//13.3도
	{134		,15624 },	//13.4도
	{135		,15554 },	//13.5도
	{136		,15484 },	//13.6도
	{137		,15414 },	//13.7도
	{138		,15345 },	//13.8도
	{139		,15275 },	//13.9도
	{140		,15205 },	//14.0도
	{141		,15139 },	//14.1도
	{142		,15073 },	//14.2도
	{143		,15008 },	//14.3도
	{144		,14942 },	//14.4도
	{145		,14876 },	//14.5도
	{146		,14810 },	//14.6도
	{147		,14745 },	//14.7도
	{148		,14679 },	//14.8도
	{149		,14614 },	//14.9도
	{150		,14548 },	//15.0도
	{151		,14486 },	//15.1도
	{152		,14425 },	//15.2도
	{153		,14363 },	//15.3도
	{154		,14302 },	//15.4도
	{155		,14240 },	//15.5도
	{156		,14178 },	//15.6도
	{157		,14116 },	//15.7도
	{158		,14055 },	//15.8도
	{159		,13993 },	//15.9도
	{160		,13931 },	//16.0도
	{161		,13873 },	//16.1도
	{162		,13815 },	//16.2도
	{163		,13758 },	//16.3도
	{164		,13700 },	//16.4도
	{165		,13642 },	//16.5도
	{166		,13584 },	//16.6도
	{167		,13526 },	//16.7도
	{168		,13468 },	//16.8도
	{169		,13410 },	//16.9도
	{170		,13352 },	//17.0도
	{171		,13298 },	//17.1도
	{172		,13243 },	//17.2도
	{173		,13189 },	//17.3도
	{174		,13134 },	//17.4도
	{175		,13080 },	//17.5도
	{176		,13025 },	//17.6도
	{177		,12971 },	//17.7도
	{178		,12916 },	//17.8도
	{179		,12862 },	//17.9도
	{180		,12807 },	//18.0도
	{181		,12756 },	//18.1도
	{182		,12705 },	//18.2도
	{183		,12654 },	//18.3도
	{184		,12603 },	//18.4도
	{185		,12552 },	//18.5도
	{186		,12501 },	//18.6도
	{187		,12450 },	//18.7도
	{188		,12398 },	//18.8도
	{189		,12347 },	//18.9도
	{190		,12296 },	//19.0도
	{191		,12281 },	//19.1도
	{192		,12267 },	//19.2도
	{193		,12252 },	//19.3도
	{194		,12238 },	//19.4도
	{195		,12223 },	//19.5도
	{196		,12208 },	//19.6도
	{197		,12194 },	//19.7도
	{198		,12179 },	//19.8도
	{199		,12165 },	//19.9도
	{200		,12150 },	//20.0도
	{201		,12101 },	//20.1도
	{202		,12053 },	//20.2도
	{203		,12004 },	//20.3도
	{204		,11956 },	//20.4도
	{205		,11907 },	//20.5도
	{206		,11858 },	//20.6도
	{207		,11810 },	//20.7도
	{208		,11761 },	//20.8도
	{209		,11713 },	//20.9도
	{210		,11664 },	//21.0도
	{211		,11617 },	//21.1도
	{212		,11571 },	//21.2도
	{213		,11524 },	//21.3도
	{214		,11478 },	//21.4도
	{215		,11431 },	//21.5도
	{216		,11384 },	//21.6도
	{217		,11338 },	//21.7도
	{218		,11291 },	//21.8도
	{219		,11245 },	//21.9도
	{220		,11198 },	//22.0도
	{221		,11153 },	//22.1도
	{222		,11108 },	//22.2도
	{223		,11064 },	//22.3도
	{224		,11019 },	//22.4도
	{225		,10974 },	//22.5도
	{226		,10929 },	//22.6도
	{227		,10884 },	//22.7도
	{228		,10840 },	//22.8도
	{229		,10795 },	//22.9도
	{230		,10750 },	//23.0도
	{231		,10707 },	//23.1도
	{232		,10664 },	//23.2도
	{233		,10621 },	//23.3도
	{234		,10578 },	//23.4도
	{235		,10535 },	//23.5도
	{236		,10492 },	//23.6도
	{237		,10449 },	//23.7도
	{238		,10406 },	//23.8도
	{239		,10363 },	//23.9도
	{240		,10320 },	//24.0도
	{241		,10279 },	//24.1도
	{242		,10237 },	//24.2도
	{243		,10196 },	//24.3도
	{244		,10154 },	//24.4도
	{245		,10113 },	//24.5도
	{246		,10072 },	//24.6도
	{247		,10030 },	//24.7도
	{248		,9989 },	//24.8도
	{249		,9947 },	//24.9도
	{250		,9906 },	//25.0도
	{251		,9866 },	//25.1도
	{252		,9826 },	//25.2도
	{253		,9786 },	//25.3도
	{254		,9746 },	//25.4도
	{255		,9706 },	//25.5도
	{256		,9666 },	//25.6도
	{257		,9626 },	//25.7도
	{258		,9586 },	//25.8도
	{259		,9546 },	//25.9도
	{260		,9506 },	//26.0도
	{261		,9468 },	//26.1도
	{262		,9429 },	//26.2도
	{263		,9391 },	//26.3도
	{264		,9352 },	//26.4도
	{265		,9314 },	//26.5도
	{266		,9275 },	//26.6도
	{267		,9237 },	//26.7도
	{268		,9198 },	//26.8도
	{269		,9160 },	//26.9도
	{270		,9121 },	//27.0도
	{271		,9084 },	//27.1도
	{272		,9046 },	//27.2도
	{273		,9009 },	//27.3도
	{274		,8971 },	//27.4도
	{275		,8934 },	//27.5도
	{276		,8897 },	//27.6도
	{277		,8860 },	//27.7도
	{278		,8822 },	//27.8도
	{279		,8785 },	//27.9도
	{280		,8748 },	//28.0도
	{281		,8712 },	//28.1도
	{282		,8676 },	//28.2도
	{283		,8639 },	//28.3도
	{284		,8603 },	//28.4도
	{285		,8567 },	//28.5도
	{286		,8531 },	//28.6도
	{287		,8495 },	//28.7도
	{288		,8458 },	//28.8도
	{289		,8422 },	//28.9도
	{290		,8386 },	//29.0도
	{291		,8376 },	//29.1도
	{292		,8365 },	//29.2도
	{293		,8355 },	//29.3도
	{294		,8344 },	//29.4도
	{295		,8334 },	//29.5도
	{296		,8324 },	//29.6도
	{297		,8313 },	//29.7도
	{298		,8303 },	//29.8도
	{299		,8292 },	//29.9도
	{300		,8282 },	//30.0도
};
int tempTableCal[10][301];
//={
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//},
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//},
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//},
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//},
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//},
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//},
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//},
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//},
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//},
//{
//	0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
//	10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
//	20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
//	30, 31, 32, 33, 34, 35, 36, 37, 38, 39,
//	40, 41, 42, 43, 44, 45, 46, 47, 48, 49,
//	50, 51, 52, 53, 54, 55, 56, 57, 58, 59,
//	60, 61, 62, 63, 64, 65, 66, 67, 68, 69,
//	70, 71, 72, 73, 74, 75, 76, 77, 78, 79,
//	80, 81, 82, 83, 84, 85, 86, 87, 88, 89,
//	90, 91, 92, 93, 94, 95, 96, 97, 98, 99,
//	100, 101, 102, 103, 104, 105, 106, 107, 108, 109,
//	110, 111, 112, 113, 114, 115, 116, 117, 118, 119,
//	120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
//	130, 131, 132, 133, 134, 135, 136, 137, 138, 139,
//	140, 141, 142, 143, 144, 145, 146, 147, 148, 149,
//	150, 151, 152, 153, 154, 155, 156, 157, 158, 159,
//	160, 161, 162, 163, 164, 165, 166, 167, 168, 169,
//	170, 171, 172, 173, 174, 175, 176, 177, 178, 179,
//	180, 181, 182, 183, 184, 185, 186, 187, 188, 189,
//	190, 191, 192, 193, 194, 195, 196, 197, 198, 199,
//	200, 201, 202, 203, 204, 205, 206, 207, 208, 209,
//	210, 211, 212, 213, 214, 215, 216, 217, 218, 219,
//	220, 221, 222, 223, 224, 225, 226, 227, 228, 229,
//	230, 231, 232, 233, 234, 235, 236, 237, 238, 239,
//	240, 241, 242, 243, 244, 245, 246, 247, 248, 249,
//	250, 251, 252, 253, 254, 255, 256, 257, 258, 259,
//	260, 261, 262, 263, 264, 265, 266, 267, 268, 269,
//	270, 271, 272, 273, 274, 275, 276, 277, 278, 279,
//	280, 281, 282, 283, 284, 285, 286, 287, 288, 289,
//	290, 291, 292, 293, 294, 295, 296, 297, 298, 299, 300
//}
//};


void AutoCal_Temp(uint8_t ch)
{
	uint32_t nowTempPoint;
	int tempTerm;

	if(ch==4)return;

	tempTerm = adcChBuff[4]- adcChBuff[ch];
	if(tempTerm>=3)
	{
		nowTempPoint = adcChBuff[ch];
		if(tempTableCal[ch][nowTempPoint] == 0)
		{
			tempTableCal[ch][nowTempPoint] = tempTerm;
		}
	}
}


uint32_t ntcTemp;
uint8_t calFlag;
uint8_t calEn;
uint8_t tempGapPrint;

int NTC_Temp_Table_Caliv(uint32_t R)
{
	static uint32_t timeStamp;
	static uint8_t step = STEP0;
	uint32_t adcFilter;
	uint8_t len;
	uint8_t str[40];
	int idata;



		for(int i =0 ;i < 300;i++)
		{
			if(tempTable[i][1] <R)
			{
				ntcTemp = tempTable[i][0];
				adcFilter = Low_Pass_Filter_Ch(ntcTemp, adcChNum);
				adcChBuff[adcChNum] = adcFilter-15;
				adcChAvg = (adcChBuff[1] + adcChBuff[4] + adcChBuff[5] + adcChBuff[9])/4;
				if(calEn)
				{
					if(calFlag)adcChBuff[adcChNum] += tempTableCal[adcChNum][i];
					else AutoCal_Temp(adcChNum);
				}
				break;
			}
		}

		if(calEn)
		{

			idata = adcChBuff[adcChNum];
			len = sprintf(str,"%d ",idata);
			HAL_UART_Transmit(&huart2,str,len,100);

			if(adcChNum==9)
			{
				HAL_UART_Transmit(&huart2,"\r\n",2,100);
			}
		}
		if(tempGapPrint)
		{
			tempGapPrint = 0;
			for(int i =0 ;i < 10;i++)
			{
				for(int j =0 ;j <= 300;j++)
				{
					idata = tempTableCal[i][j];
					len = sprintf(str,"%d\r\n",idata);
					HAL_UART_Transmit(&huart2,str,len,100);


				}
				HAL_UART_Transmit(&huart2,"\r\n",2,100);
				HAL_UART_Transmit(&huart2,"\r\n",2,100);
			}
		}


}
uint32_t R_Ntc;

void NTC_TempWhile()
{
	static uint32_t timeStamp;

	if(HAL_GetTick()-timeStamp >= 30)
	{
		uint16_t raw = ADC1_ReadOnce();
		float r_ntc = 0.0f;

		NTC_AdcToResistance(raw, &r_ntc);

		R_Ntc = r_ntc;
		NTC_Temp_Table_Caliv(R_Ntc);
//		Temp_Debug_Printf();
		timeStamp = HAL_GetTick();
	}
	PID_Ctrl();


}

